<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MC PREDICT - MATCH WINNER BEST VALUE (Historical)</title>

  <!-- Fonts + global stylesheet -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Proxima+Nova:wght@400;700&display=swap">
  <link rel="stylesheet" href="style.css">
</head>

<body class="home">
  <div class="home-page">

    <!-- Top bar -->
    <header class="home-topbar">
      <div class="topbar-inner">
        <div class="topbar-left">
          <div class="topbar-logo">
            <img src="images/mcpredcirclebg.png" alt="MC Predict Logo">
          </div>
          <div class="topbar-title">
            <h1>MC PREDICT</h1>
            <span>Data-driven Football predictions</span>
          </div>
        </div>
        <div class="topbar-tag">
          <span class="topbar-tag-dot"></span>
          <span>Historical ¬∑ Match Result</span>
        </div>
      </div>

      <!-- Desktop / tablet nav -->
      <nav class="primary-nav" aria-label="Primary navigation">
        <a href="/index">Home</a>
        <a href="/hda-value">Match Result</a>
        <a href="/uo-value">Under/Over 2.5</a>
        <a href="/lucky-dip">Lucky Dip</a>
        <a href="/historical" class="active">Historical Data</a>
        <a href="/faqs">FAQs</a>
      </nav>
    </header>

    <!-- Content -->
    <section aria-labelledby="results-heading">
      <div class="results-header">
        <div class="results-eyebrow">Historical Performance</div>
        <h2 id="results-heading" class="results-title">Match Result ‚Äì Best Value (Summary)</h2>
        <p class="results-subtitle">
          These tables summarise how the Match Result ‚ÄúBest Value‚Äù model has performed across
          different categories over time.
        </p>
        <p class="results-note">
          NOTE: The returns are calculated on decimal odds and may not perfectly align to the
          fractional odds represented below. You can view the actual decimal odds for individual
          fixtures on the full history pages.
        </p>
      </div>

      <div class="mobile-info">
        If you are viewing on mobile, the tables are compressed and text is reduced so everything fits
        on screen without horizontal scrolling.
      </div>

      <div class="loading-message" id="loadingMessage">
        Loading latest historical data‚Ä¶
      </div>

      <div class="tables-wrap" id="tablesWrap"></div>
    </section>

    <footer class="home-footer">
      MC Predict is for informational purposes only and does not guarantee outcomes. Please bet responsibly.
    </footer>
  </div>

  <!-- Bottom mobile nav -->
  <nav class="bottom-nav" aria-label="Primary navigation">
    <a href="/index" data-key="home">
      <span class="icon">üè†</span>
      <span class="label">Home</span>
    </a>
    <a href="/hda-value" data-key="hda">
      <span class="icon">üèÜ</span>
      <span class="label">Result</span>
    </a>
    <a href="/uo-value" data-key="uo">
      <span class="icon">‚öΩ</span>
      <span class="label">U/O 2.5</span>
    </a>
    <a href="/lucky-dip" data-key="lucky">
      <span class="icon">üé≤</span>
      <span class="label">Lucky</span>
    </a>
    <a href="/historical" class="active" data-key="historical">
      <span class="icon">üìä</span>
      <span class="label">History</span>
    </a>
    <a href="/faqs" data-key="faqs">
      <span class="icon">‚ùì</span>
      <span class="label">FAQs</span>
    </a>
  </nav>

  <script>
    // Same CSV parsing + 3-table logic as your original page,
    // just plugged into the new layout.

    // Small CSV parser that supports quoted fields and embedded commas.
    // Returns array of rows; each row is an array of strings.
    function parseCSV(text) {
      const rows = [];
      let row = [];
      let cur = '';
      let i = 0;
      const len = text.length;
      let inQuotes = false;

      while (i < len) {
        const ch = text[i];

        if (inQuotes) {
          if (ch === '"') {
            if (i + 1 < len && text[i + 1] === '"') {
              // Escaped quote ("")
              cur += '"';
              i += 2;
              continue;
            } else {
              inQuotes = false;
              i++;
              continue;
            }
          } else {
            cur += ch;
            i++;
            continue;
          }
        } else {
          if (ch === '"') {
            inQuotes = true;
            i++;
            continue;
          }
          if (ch === ',') {
            row.push(cur);
            cur = '';
            i++;
            continue;
          }
          if (ch === '\r') {
            i++;
            continue;
          }
          if (ch === '\n') {
            row.push(cur);
            rows.push(row);
            row = [];
            cur = '';
            i++;
            continue;
          }
          cur += ch;
          i++;
        }
      }
      row.push(cur);
      rows.push(row);
      return rows;
    }

    (async function () {
      const csvUrl =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vRoeausAAqFFCFoB0NK4vjsgmmzxP_J-WtgvUdusuau-jmJ3d3fqPAAa_ujd7nGYag5rJFOysZZUYiA/pub?gid=1680844079&single=true&output=csv";

      // Sheet structure (1-based):
      //  - Title row above each section header
      //  - Section header rows at 3, 15, 26
      const headerRows1Based = [3, 15, 26];

      function buildTitleFromRow(rowArr) {
        const bits = rowArr
          .map(x => (x || '').trim())
          .filter(Boolean);
        return bits.length ? bits.join(" ‚Ä¢ ") : "";
      }

      function buildTableHTML(headers, rows) {
        let html = '<table class="value-table"><thead><tr>';
        headers.forEach(h => {
          html += `<th>${h}</th>`;
        });
        html += '</tr></thead><tbody>';

        rows.forEach(r => {
          const cells = r.slice(0, headers.length);
          while (cells.length < headers.length) cells.push("");
          html += "<tr>";
          cells.forEach(c => {
            html += `<td>${c}</td>`;
          });
          html += "</tr>";
        });

        html += "</tbody></table>";
        return html;
      }

      try {
        const res = await fetch(csvUrl, { cache: "no-store" });
        if (!res.ok) {
          throw new Error(`Fetch failed: ${res.status} ${res.statusText}`);
        }
        const text = await res.text();
        const rows = parseCSV(text);

        // Convert 1-based to 0-based
        const headerIdx = headerRows1Based.map(n => n - 1);
        const titleIdx = headerIdx.map(i => Math.max(0, i - 1));

        const sections = [];
        for (let s = 0; s < headerIdx.length; s++) {
          const hIdx = headerIdx[s];
          const tIdx = titleIdx[s];
          const nextT = s < headerIdx.length - 1 ? titleIdx[s + 1] : rows.length;

          const headers = (rows[hIdx] || []).map(x => String(x ?? ""));
          const titleRow = rows[tIdx] || [];
          const title = buildTitleFromRow(titleRow);

          const dataStart = hIdx + 1;
          const dataEnd = Math.max(dataStart, nextT); // exclusive
          const body = rows.slice(dataStart, dataEnd);

          sections.push({ title, headers, body });
        }

        const wrap = document.getElementById("tablesWrap");
        wrap.innerHTML = sections
          .map(sec => {
            const titleBar = sec.title
              ? `<div class="section-title">${sec.title}</div>`
              : "";
            return `${titleBar}${buildTableHTML(sec.headers, sec.body)}`;
          })
          .join("");

      } catch (err) {
        console.error(err);
        document.getElementById("tablesWrap").innerHTML =
          '<div class="loading-message">Sorry, something went wrong loading the data.</div>';
      } finally {
        document.getElementById("loadingMessage").style.display = "none";
      }
    })();
  </script>
</body>
</html>
