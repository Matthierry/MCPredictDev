<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MC PREDICT - MATCH RESULT BEST VALUE</title>

  <!-- Fonts + site stylesheet -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Proxima+Nova:wght@400;700&display=swap">
  <link rel="stylesheet" href="style.css">
</head>

<body class="home">
  <div class="home-page">

    <!-- ---------------- TOP BAR ---------------- -->
    <header class="home-topbar">
      <div class="topbar-inner">
        <div class="topbar-left">
          <div class="topbar-logo">
            <img src="images/mcpredcirclebg.png" alt="MC Predict Logo">
          </div>
          <div class="topbar-title">
            <h1>MC PREDICT</h1>
            <span>Data-driven football predictions</span>
          </div>
        </div>
        <div class="topbar-tag">
          <span class="topbar-tag-dot"></span>
          <span>Historical · Match Result</span>
        </div>
      </div>

      <!-- Desktop nav -->
      <nav class="primary-nav">
        <a href="/index">Home</a>
        <a href="/hda-value">Match Result</a>
        <a href="/uo-value">Under/Over 2.5</a>
        <a href="/lucky-dip">Lucky Dip</a>
        <a href="/historical" class="active">Historical</a>
        <a href="/faqs">FAQs</a>
      </nav>
    </header>


    <!-- ---------------- PAGE HEADER ---------------- -->
    <section>
      <div class="results-header">
        <div class="results-eyebrow">Historical Summary</div>
        <h2 class="results-title">Match Result – Best Value</h2>
        <p class="results-subtitle">
          A breakdown of how the best-value categories have performed across multiple seasons.
        </p>
      </div>

      <div class="mobile-info">
        Mobile view is optimised so tables fit without sideways scrolling.
      </div>

      <div class="loading-message" id="loadingMessage">Loading latest data…</div>

      <div class="tables-wrap" id="tablesWrap"></div>
    </section>
  </div>


  <!-- ---------------- JAVASCRIPT (CSV → TABLES) ---------------- -->
  <script>
    function parseCSV(text) {
      const rows = [];
      let row = [], cur = "", i = 0;
      let inQuotes = false;

      while (i < text.length) {
        const ch = text[i];

        if (inQuotes) {
          if (ch === '"') {
            if (text[i+1] === '"') { cur += '"'; i += 2; continue; }
            inQuotes = false; i++; continue;
          }
          cur += ch; i++; continue;
        }

        if (ch === '"') { inQuotes = true; i++; continue; }
        if (ch === ',') { row.push(cur); cur = ""; i++; continue; }
        if (ch === '\n') { row.push(cur); rows.push(row); row = []; cur = ""; i++; continue; }

        i++; cur += ch;
      }

      row.push(cur);
      rows.push(row);
      return rows;
    }

    (async function () {
      const csvUrl =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vRoeausAAqFFCFoB0NK4vjsgmmzxP_J-WtgvUdusuau-jmJ3d3fqPAAa_ujd7nGYag5rJFOysZZUYiA/pub?gid=1843663391&single=true&output=csv";

      const headerRows = [3, 15, 26]; // 1-based

      function buildTitle(row) {
        return row.map(x => x.trim()).filter(Boolean).join(" • ");
      }

      function buildTable(headers, rows) {
        let html = '<table class="value-table"><thead><tr>';
        headers.forEach(h => html += `<th>${h}</th>`);
        html += '</tr></thead><tbody>';

        rows.forEach(r => {
          html += '<tr>';
          headers.forEach((_, idx) => html += `<td>${r[idx] || ""}</td>`);
          html += '</tr>';
        });

        return html + '</tbody></table>';
      }

      try {
        const res = await fetch(csvUrl, { cache: "no-store" });
        const text = await res.text();
        const rows = parseCSV(text);

        const output = [];
        for (let s = 0; s < headerRows.length; s++) {
          const headerIndex = headerRows[s] - 1;
          const titleIndex = headerIndex - 1;

          const headers = rows[headerIndex];
          const title = buildTitle(rows[titleIndex] || []);

          const nextStart = (headerRows[s+1] || rows.length + 1) - 1;
          const sectionRows = rows.slice(headerIndex + 1, nextStart);

          output.push(
            (title ? `<div class="section-title">${title}</div>` : "") +
            buildTable(headers, sectionRows)
          );
        }

        document.getElementById("tablesWrap").innerHTML = output.join("");

      } catch (err) {
        document.getElementById("tablesWrap").innerHTML =
          '<div class="loading-message">Error loading data.</div>';
      }

      document.getElementById("loadingMessage").style.display = "none";
    })();
  </script>
</body>
</html>
