<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MC PREDICT - MATCH RESULT BEST VALUE</title>

  <!-- Global site stylesheet -->
  <link rel="stylesheet" href="style.css">

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Proxima+Nova:wght@400;700&display=swap">
</head>

<body class="home">
  <!-- Soccer-themed loading overlay -->
  <div class="loading-overlay" id="loadingOverlay" aria-live="polite">
    <div class="loading-ball">‚öΩ</div>
    <div class="loading-pitch-line"></div>
    <div class="loading-title">Calculating Value</div>
    <p class="loading-subtitle">
      We&#39;re lining up today&#39;s best value fixtures based on the latest model and market prices.
    </p>
    <div class="loading-ticker">Loading match data...</div>
  </div>

  <div class="home-page">

    <!-- Top bar -->
    <header class="home-topbar">
      <div class="topbar-inner">
        <div class="topbar-left">
          <div class="topbar-logo">
            <img src="images/mcpredcirclebg.png" alt="MC Predict Logo">
          </div>
          <div class="topbar-title">
            <h1>MC PREDICT</h1>
            <span>Data-driven Football predictions</span>
          </div>
        </div>
        <div class="topbar-tag">
          <span class="topbar-tag-dot"></span>
          <span>Match Result</span>
        </div>
      </div>

      <!-- Desktop / tablet nav -->
      <nav class="primary-nav" aria-label="Primary navigation">
        <a href="/index">Home</a>
        <a href="/hda-value" class="active">Match Result</a>
        <a href="/uo-value">Under/Over 2.5</a>
        <a href="/lucky-dip">Lucky Dip</a>
        <a href="/historical">Historical Data</a>
        <a href="/faqs">FAQs</a>
      </nav>

      <!-- Sub-nav for this section -->
      <div class="sub-nav-pills" aria-label="Match Result views">
        <a href="/hda-value" class="active">Best Value</a>
        <a href="/hda-highchance">Highest Chance</a>
      </div>
    </header>

    <!-- Main data layout -->
    <section class="data-layout">
      <!-- Filters + table -->
      <div class="data-main-card">
        <div class="data-eyebrow">Match Result</div>
        <h2 class="data-title">Best value selections</h2>
        <p class="data-subtitle">
          Use the filters to focus on specific days or outcomes. The table updates instantly
          using the latest data from the model.
        </p>

        <!-- Day filters -->
        <div class="data-label">Filter by day</div>
        <div class="filters-row" id="day-filters">
          <!-- buttons injected by JS -->
        </div>

        <!-- Result filters -->
        <div class="data-label">Filter by predicted result</div>
        <div class="filters-row" id="result-filters">
          <button data-result="HOME WIN">Home Win</button>
          <button data-result="AWAY WIN">Away Win</button>
        </div>

        <div class="mobile-info">
          Bookmaker and model prices are shown in the price columns.
        </div>

        <!-- Table -->
        <div class="table-container" id="sheet-data"></div>
      </div>

      <!-- Side info / value key -->
      <aside class="data-side-card">
        <h3 class="data-side-title">Value key</h3>
        <p class="data-side-subtitle">
          Each fixture has a value rating based on how strongly the model disagrees with the market.
        </p>
        <ul class="value-list">
          <li><span class="emoji">üí∞üí∞üí∞</span> Highest perceived value</li>
          <li><span class="emoji">üí∞üí∞</span> Strong value</li>
          <li><span class="emoji">üí∞</span> Mild value edge</li>
          <li><span class="emoji">‚ùå</span> Equal price or mild poor value</li>
          <li><span class="emoji">‚ùå‚ùå</span> Poor value</li>
          <li><span class="emoji">‚ùå‚ùå‚ùå</span> Very poor value</li>
        </ul>

        <p class="side-note">
          Remember: value does not guarantee a win on a single game. It‚Äôs designed for long-term
          edges across many bets.
        </p>
      </aside>
    </section>

    <footer class="home-footer">
      MC Predict is for informational purposes only and does not guarantee outcomes. Please bet responsibly.
    </footer>
  </div>

  <!-- Bottom mobile nav -->
  <nav class="bottom-nav" aria-label="Primary navigation">
    <a href="/index" data-key="home">
      <span class="icon">üè†</span>
      <span class="label">Home</span>
    </a>
    <a href="/hda-value" class="active" data-key="hda">
      <span class="icon">üèÜ</span>
      <span class="label">Result</span>
    </a>
    <a href="/uo-value" data-key="uo">
      <span class="icon">‚öΩ</span>
      <span class="label">U/O 2.5</span>
    </a>
    <a href="/lucky-dip" data-key="lucky">
      <span class="icon">üé≤</span>
      <span class="label">Lucky</span>
    </a>
    <a href="/historical" data-key="historical">
      <span class="icon">üìä</span>
      <span class="label">History</span>
    </a>
    <a href="/faqs" data-key="faqs">
      <span class="icon">‚ùì</span>
      <span class="label">FAQs</span>
    </a>
  </nav>

  <script>
    let allRows = [];
    let headerRow = [];
    let dataRows = [];

    const activeDayFilters = new Set();
    const activeResultFilters = new Set();

    function csvToRows(text) {
      // Simple CSV split; assumes your sheet cells don't contain unescaped commas/newlines.
      return text.trim().split("\n").map(r => r.split(","));
    }

    function hideLoadingOverlay() {
      const overlay = document.getElementById("loadingOverlay");
      if (!overlay) return;
      overlay.classList.add("hidden");
      setTimeout(() => {
        overlay.style.display = "none";
      }, 450);
    }

    async function loadCSV() {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_1dSqKC6BUuykrL9QA5_fwiIEodU3jXBCskHCA7uVU-EYnHusQWZhMFwZXNvk2bFlElmsQHZ3b4n2/pub?gid=772292951&single=true&output=csv";

      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        const text = await response.text();
        allRows = csvToRows(text);

        // Headers are in Row 2 (index 1). Data starts at Row 3 (index 2).
        headerRow = allRows[1] || [];
        dataRows = allRows.slice(2);

        buildDayButtons();
        attachResultButtonHandlers();
        renderTable();
      } catch (err) {
        console.error("Error loading CSV:", err);
        const container = document.getElementById("sheet-data");
        if (container) {
          container.innerHTML = "<p class='load-error'>We couldn&#39;t load today&#39;s data. Please refresh the page in a moment.</p>";
        }
      } finally {
        hideLoadingOverlay();
      }
    }

    function buildDayButtons() {
      const dayFiltersDiv = document.getElementById("day-filters");
      dayFiltersDiv.innerHTML = "";

      // Column A = day (index 0); filter out blanks and normalize
      const uniqueDays = Array.from(new Set(
        dataRows
          .map(r => (r[0] || "").trim())
          .filter(v => v.length > 0)
      ));

      uniqueDays.forEach(day => {
        const btn = document.createElement("button");
        btn.textContent = day;
        btn.dataset.day = day;
        btn.addEventListener("click", () => {
          if (activeDayFilters.has(day)) {
            activeDayFilters.delete(day);
            btn.classList.remove("active");
          } else {
            activeDayFilters.add(day);
            btn.classList.add("active");
          }
          renderTable();
        });
        dayFiltersDiv.appendChild(btn);
      });
    }

    function attachResultButtonHandlers() {
      document.querySelectorAll("#result-filters button").forEach(btn => {
        btn.addEventListener("click", () => {
          const value = (btn.dataset.result || "").trim().toUpperCase(); // e.g., "HOME WIN"
          if (activeResultFilters.has(value)) {
            activeResultFilters.delete(value);
            btn.classList.remove("active");
          } else {
            activeResultFilters.add(value);
            btn.classList.add("active");
          }
          renderTable();
        });
      });
    }

    function rowMatchesFilters(row) {
      const dayVal = (row[0] || "").trim();                  // Column A
      const resultVal = (row[5] || "").trim().toUpperCase(); // Column F

      const dayOk = activeDayFilters.size === 0 || activeDayFilters.has(dayVal);
      const resultOk = activeResultFilters.size === 0 || activeResultFilters.has(resultVal);

      return dayOk && resultOk;
    }

    function renderTable() {
      const container = document.getElementById("sheet-data");

      let html = "<table>";

      // Headers
      if (headerRow.length) {
        html += "<tr>" + headerRow.map(cell => `<th>${cell}</th>`).join("") + "</tr>";
      }

      // Filtered data rows
      dataRows.forEach(row => {
        if (rowMatchesFilters(row)) {
          html += "<tr>" + row.map(cell => `<td>${cell}</td>`).join("") + "</tr>";
        }
      });

      html += "</table>";
      container.innerHTML = html;
    }

    loadCSV();
  </script>
</body>
</html>
